const ratesch_dev = {
    "WI-TIER": ["W-AUTO-CCF-15MIN","W-MANUAL-CCF-S","W-AUTO-CCF-60MIN"],
    "GASDFLT": ["G-AUTO-CCF-15MIN", "G-AUTO-CCF-60MIN","G-MANUAL-CCF-S"],
    "WWDFLT": ["W-AUTO-CCF-60MIN", "W-MANUAL-CCF-S","W-AUTO-CCF-15MIN"],
    "ER-BASIC": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "ER-PPB": ["E-AUTO-KWH-60MIN"],
    "E-INTDMD": ["E-AUTO-KW-15MIN"],
    "MRR-TEST": [],
    "E-DIST": ["E-AUTO-KWH-60MIN","E-MANUAL-KWH-S"],
    "G-DIST": ["G-AUTO-CCF-60MIN","G-AUTO-CCF-15MIN","G-MANUAL-CCF-S"],
    "W-DFLT-M": ["W-AUTO-CCF-60MIN","W-MANUAL-CCF-S","W-AUTO-CCF-15MIN"],
    "ERES4": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "RF-RES": [],
    "E-ENERGY": ["E-AUTO-KWH-15MIN","E-AUTO-KWHKVARH-60MIN","E-MANUAL-KWHTOU-S"],
    "E-RPTR": ["E-AUTO-KWH-60MIN"],
    "INNOETOU": ["E-AUTO-KWH-15MIN","E-AUTO-KWH-30MIN","E-AUTO-KWH-60MIN","E-SOLAR-KWH-15MIN","E-SOLAR-KWH-60MIN"],
    "INNOE2TR": ["E-AUTO-KWH-15MIN","E-AUTO-KWH-30MIN","E-AUTO-KWH-60MIN"],
    "INNOMHPR": [],
    "INNOGSTD": ["G-AUTO-CCF-60MIN","G-AUTO-CCF-15MIN","G-MANUAL-CCF-S"],
    "INNOEELV": ["E-AUTO-KWH-15MIN","E-AUTO-KWH-30MIN","E-AUTO-KWH-60MIN","E-SOLAR-KWH-15MIN","E-SOLAR-KWH-60MIN"],
    "INNOW3TR": ["W-AUTO-CCF-60MIN","W-MANUAL-CCF-S","W-AUTO-CCF-15MIN"],
    "INNOWWST": ["W-AUTO-CCF-60MIN","W-MANUAL-CCF-S","W-AUTO-CCF-15MIN"],
    "INNOESTD": ["E-MANUAL-KWH-S","E-AUTO-KWH-15MIN","E-AUTO-KWH-30MIN","E-AUTO-KWH-60MIN"],
    "ZZRS2135": ["E-AUTO-KWH-ON-OFF-NET"],
    "SSH-BF": ["E-AUTO-KWH-60MIN", "E-AUTO-KWH-S", "E-AUTO-KWHNET", "E-MANUAL-KWH-S", "E-MANUAL-KWHKW-S"],
    "NEM-TOUS": ["E-SOLAR-KWH-60MIN"],
    "ERES1": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "NEM-TOUM": ["E-SOLAR-KWH-60MIN"],
    "WWDFLT-M": ["W-AUTO-CCF-15MIN", "W-AUTO-CCF-60MIN","W-MANUAL-CCF-S"],
    "W-TIER": ["W-AUTO-CCF-60MIN","W-AUTO-CCF-15MIN","W-MANUAL-CCF-S"],
    "W-SEAS": ["W-AUTO-CCF-60MIN",,"W-AUTO-CCF-15MIN","W-MANUAL-CCF-S"],
    "ER-TOUMI": ["E-AUTO-KWH-60MIN"],
    "EC-STPSE": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "E-INTCON": ["E-AUTO-KWH-15MIN","E-AUTO-KWH-30MIN","E-AUTO-KWH-60MIN"],
    "E-TOU": ["E-AUTO-KWH-60MIN","E-AUTO-KWH-15MIN","E-AUTO-KWHKVARH-60MIN","E-MANUAL-KWHTOU-S"],
    "ER-DMINU": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "E-LIGHT": [],
    "EC-TOUDM": ["E-AUTO-KWH-60MIN","E-AUTO-KWH-15MIN","E-AUTO-KWHKVARH-60MIN","E-MANUAL-KWHTOU-S"],
    "G-SGSVC": ["G-AUTO-CCF-60MIN","G-AUTO-CCF-15MIN","G-MANUAL-CCF-S"],
    "ERES2": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "ERES3": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "ECOM1": ["E-AUTO-KWH-60MIN",,"E-AUTO-KWH-15MIN","E-AUTO-KWHKVARH-60MIN","E-MANUAL-KWHTOU-S"],
    "ECOM2": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "G-SEAS": ["G-AUTO-CCF-60MIN","G-AUTO-CCF-15MIN","G-MANUAL-CCF-S"],
    "WC-TIER": ["W-AUTO-CCF-60MIN","W-AUTO-CCF-15MIN","W-MANUAL-CCF-S"],
    "WDFLT": ["W-AUTO-CCF-15MIN", "W-AUTO-CCF-60MIN", "W-MANUAL-CCF-S", "W-S-MAN-100GAL", "W-S-MAN-HILO"],
    "SSH-CV": ["E-AUTO-KW-15MIN","E-MANUAL-KWH-S"],
    "SSH-TOU": ["E-AUTO-KWH-60MIN", "E-MANUAL-KWHTOU-SSH"],
    "SSH-IB": ["E-AUTO-KWH-60MIN"],
    "SSHIB4SP": ["E-AUTO-KWH-60MIN"],
    "SSHIMSP": ["E-AUTO-KWH-15MIN", "E-AUTO-KWH-60MIN"],
    "ACRES": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "EU-BASIC": ["E-S-KWH-DWP","E-AUTO-KWH-60MIN", "E-AUTO-KWH-S","E-MANUAL-KWH-S"],
    "SSH-AT": ["E-AUTO-KWH-60MIN"],
    "SSH-SC": ["E-AUTO-KWH-60MIN", "E-AUTO-KWH-S"],
    "SSH-2V": ["E-AUTO-KWH-60MIN", "E-AUTO-KWHNET"],
    "ZZINTCON": ["E-AUTO-KWH-15MIN","E-AUTO-KWH-30MIN","E-AUTO-KWH-60MIN"],
    "STW-RES": [],
    "SSH": ["E-AUTO-KWH-60MIN", "E-AUTO-KWH-S", "E-AUTO-KWHNET", "E-MANUAL-KWH-S", "E-MANUAL-KWHKW-S", "SSH-E-MANUAL-KWHTOU-S","E-AUTO-KW-15MIN"],
    "SSH-ITEM": [],
    "SSH-TE": ["E-AUTO-KWH-60MIN", "E-AUTO-KWH-S", "E-AUTO-KWHNET", "E-MANUAL-KWH-S", "E-MANUAL-KWHKW-S"],
    "MPPCH": ["E-AUTO-KWH-60MIN","E-AUTO-KWH-30MIN","E-AUTO-KWH-60MIN"],
    "CM_TSTRT": ["E-MANUAL-KWH-S"],
    "SSH-MV": ["E-AUTO-KWH-60MIN", "E-AUTO-KWH-S", "E-AUTO-KWHNET", "E-MANUAL-KWH-S", "E-MANUAL-KWHKW-S"],
    "MRR-TEST1": ["E-AUTO-KWH-60MIN"],
    "SSH-IB-S": ["E-AUTO-KWH-60MIN"]
  };
  function rate_deviceconfig(dev_conf_id,sa_id) {
    process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
    
    let accounturl = `https://ugbu-phx-1113.snphxprshared1.gbucdsint02phx.oraclevcn.com:6201/ouaf/rest/apis/customer/v-model/serviceAgreements/${sa_id}`;
    let username = 'SYSUSER';
    let password = 'sysuser00';
    let headers = new Headers();
    let rss = '';
    let dctype = '';
  
    headers.set('Authorization', 'Basic ' + Buffer.from(username + ":" + password).toString('base64'));
  
    // Fetch request to get the rate schedule
    fetch(accounturl, {
      method: 'GET',
      headers: headers,
    })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(json => {
        const rs = json.rateScheduleHistory._data;
        const size = Object.keys(rs).length;
        rss = rs[size - 1].rateSchedule.rateSchedule;
        console.log(`Rate Schedule : ${rss}`);
  
        // Second fetch request to get the device configuration, after the first fetch is done
        const deviceConfigUrl = `https://ugbu-phx-1113.snphxprshared1.gbucdsint02phx.oraclevcn.com:6201/ouaf/rest/apis/meter/devices/deviceConfigurations/${dev_conf_id}`;
        return fetch(deviceConfigUrl, { method: 'GET', headers: headers });
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(json => {
        dctype = json.deviceConfigurationType.deviceConfigurationType;
        console.log(`Device Configuration : ${dctype}`);
  
        // Check if dctype is valid for the rate schedule
        if(rss === '')
          console.log('The rate schedule is missing.')
        if(dctype === '')
          console.log('The device configuration is missing')
        if(rss != '' && dctype != ''){
          if(ratesch_dev[rss] === '')
            console.log('This rate schedule has no particular valid device configurations')
          else{
            if (ratesch_dev[rss] && ratesch_dev[rss].includes(dctype)) {
              console.log(`The device configuration ${dctype} is valid for the rate schedule ${rss}`);
            } else {
              console.log(`The device configuration ${dctype} is not valid for the rate schedule ${rss}`);
            }
        }
       }
      })
      .catch(error => {
        console.error('Error occurred:', error);
      });
  }
  
//rate_deviceconfig();

console.log("test");

module.exports = rate_deviceconfig;